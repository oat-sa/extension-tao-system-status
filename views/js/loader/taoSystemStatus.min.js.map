{"version":3,"sources":["../controller/SystemStatus/reportDetailsModal!tpl","../widgets/executionStatistics.js","../controller/PerformanceMonitoring/index.js","../controller/routes.js","../tasksMonitoring/tasksStatistics.js","../controller/SystemStatus/index.js","module-create.js"],"names":[],"mappings":"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","sourcesContent":["\ndefine('tpl!taoSystemStatus/controller/SystemStatus/reportDetailsModal', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType=\"function\";\n\n\n  buffer += \"<div class=\\\"modal report-details-modal\\\">\\n    <section>\\n        <h1>\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Task data\", options) : helperMissing.call(depth0, \"__\", \"Task data\", options)))\n    + \"\\n        </h1>\\n        \";\n  if (helper = helpers.data) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.data); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n    </section>\\n</div>\";\n  return buffer;\n  });\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA ;\n */\ndefine('taoSystemStatus/widgets/executionStatistics',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'ui/component',\n    'util/url',\n    'c3'\n], function ($, _, __, component, url, c3) {\n    'use strict';\n\n    /**\n     * Some default config\n     * @type {Object}\n     * @private\n     */\n    var _defaults = {\n        graphConfig : {\n            bindto: '.js-execution-statistics-graph',\n            padding: {\n                bottom: 0,\n                left: 0\n            },\n            data: {\n                url: url.route('executionsStatistics', 'PerformanceMonitoring', 'taoSystemStatus', { 'interval' : getInterval()}),\n                x: 'time',\n                xFormat: '%Y-%m-%d %H:%M:%S',\n                mimeType: 'json',\n                type: 'bar'\n            },\n            bar: {\n                width: {\n                    ratio: 0.7\n                }\n            },\n            tooltip: {\n                format: {\n                    title: function (x, y) {\n                       return new Date(Date.parse(x)).toUTCString();\n                    }\n                }\n            },\n            axis: {\n                x: {\n                    type: 'timeseries',\n                    tick: {\n                        format: '%H:%M'\n                    },\n                    label: {\n                        position: 'bottom center'\n                    }\n                },\n                y: {\n                    inner: true,\n                    label: {\n                        position: 'outer-top',\n                    }\n                }\n            }\n        }\n    };\n\n    /**\n     * Get interval to build statistics\n     * @return string\n     */\n    function getInterval() {\n       return $('.js-execution-statistics-interval').val();\n    }\n\n    /**\n     * @param {Object} config\n     * @param {String} [config.graphConfig] - configuration of c3 chart\n     * @param {String} [config.autoRefresh] - interval of auto refresh\n     * @param {String} [config.autoRefreshBar] - show auto refresh bar\n     */\n    function factory(config) {\n        var initConfig = _.merge({}, _defaults, config);\n        var chart;\n        var graph = {\n            /**\n             * Refresh the graph\n             * @param {Object} newConfig\n             */\n            refresh: function refresh(newConfig) {\n                if (chart) {\n                    initConfig = _.merge({}, initConfig, newConfig);\n                    //there is no way to update graph with new config\n                    chart.internal.config.axis_x_tick_format = initConfig.graphConfig.axis.x.tick.format;\n                    chart.axis.labels({\n                        x: initConfig.graphConfig.axis.x.label.text\n                    });\n                    chart.load(initConfig.graphConfig.data);\n                }\n            },\n        };\n        /**\n         * Get chart config\n         * @return {Object}\n         */\n        function getChartConfig() {\n            const interval = getInterval();\n            return _.merge({}, initConfig, {\n                graphConfig: {\n                    data: {\n                        url: url.route('executionsStatistics', 'PerformanceMonitoring', 'taoSystemStatus', { 'interval' : interval }),\n                    },\n                    axis: {\n                        x : {\n                            tick : {\n                                format: interval === 'P1D' ? '%H:%M' : '%m-%d'\n                            },\n                            label : {\n                                text:  interval === 'P1D' ? __('Hours') : __('Days')\n                            }\n                        }\n                    }\n                }\n            });\n        }\n\n\n        $('.js-execution-statistics-interval').on('change', function () {\n            graph.refresh(getChartConfig());\n        });\n\n        return component(graph)\n            .on('render', function() {\n                chart = c3.generate(getChartConfig().graphConfig);\n            })\n            .on('destroy', function() {\n                chart.destroy();\n                chart = null;\n            })\n            .init(initConfig);\n    }\n\n    return factory;\n});\n\n","define('taoSystemStatus/controller/PerformanceMonitoring/index',[\n    'tpl!taoSystemStatus/controller/SystemStatus/reportDetailsModal',\n    'taoSystemStatus/widgets/executionStatistics'\n], function(layout, executionStatisticsFactory) {\n    'use strict';\n\n    return {\n        start : function() {\n            var executionStatistics;\n            executionStatistics = executionStatisticsFactory();\n            executionStatistics.render();\n        }\n    }\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2019 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\n\ndefine('taoSystemStatus/controller/routes',[],function(){\n    'use strict';\n\n    return {\n        'SystemStatus': {\n            'actions' : {\n                'index' : 'controller/SystemStatus/index'\n            }\n        },\n        'PerformanceMonitoring': {\n            'actions' : {\n                'index' : 'controller/PerformanceMonitoring/index'\n            }\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2019 (original work) Open Assessment Technologies SA ;\n */\ndefine('taoSystemStatus/tasksMonitoring/tasksStatistics',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'ui/component',\n    'util/url',\n    'c3'\n], function ($, _, __, component, url, c3) {\n    'use strict';\n\n    /**\n     * Some default config\n     * @type {Object}\n     * @private\n     */\n    var _defaults = {\n        graphConfig : {\n            bindto: '.js-tasks-graph',\n            padding: {\n                bottom: 0,\n                left: 0\n            },\n            data: {\n                x: 'time',\n                xFormat: '%Y-%m-%d %H:%M:%S',\n                mimeType: 'json',\n                type: 'line',\n                names: {\n                    amount: __('Tasks processed'),\n                    average: __('Average processing time, s')\n                }\n            },\n            tooltip: {\n                format: {\n                    title: function (x, y) {\n                       return new Date(Date.parse(x)).toUTCString();\n                    }\n                }\n            },\n            axis: {\n                x: {\n                    type: 'timeseries',\n                    tick: {\n                        format: '%H:%M'\n                    },\n                    label: {\n                        position: 'bottom center'\n                    }\n                },\n                y: {\n                    inner: true,\n                    label: {\n                        position: 'outer-top',\n                    }\n                }\n            }\n        }\n    };\n\n    /**\n     * Get interval to build statistics\n     * @return string\n     */\n    function getInterval() {\n       return $('.js-tasks-statistics-interval').val();\n    }\n\n    function getData(period) {\n        return $('.js-tasks-graph').data('statistics')[period];\n    }\n\n    /**\n     * @param {Object} config\n     * @param {String} [config.graphConfig] - configuration of c3 chart\n     * @param {String} [config.autoRefresh] - interval of auto refresh\n     * @param {String} [config.autoRefreshBar] - show auto refresh bar\n     */\n    function tasksGraphFactory(config) {\n        var initConfig = _.merge({}, _defaults, config);\n        var chart;\n        var activityGraph = {\n            /**\n             * Refresh the graph\n             * @param {Object} newConfig\n             */\n            refresh: function refresh(newConfig) {\n                if (chart) {\n                    initConfig = _.merge({}, initConfig, newConfig);\n                    //there is no way to update graph with new config\n                    chart.internal.config.axis_x_tick_format = initConfig.graphConfig.axis.x.tick.format;\n                    chart.axis.labels({\n                        x: initConfig.graphConfig.axis.x.label.text\n                    });\n                    chart.load(newConfig.graphConfig.data);\n                }\n            }\n        };\n        /**\n         * Get chart config\n         * @return {Object}\n         */\n        function getChartConfig() {\n            var interval = getInterval();\n            var newConfig;\n            var data = getData(interval);\n            newConfig = _.merge({}, _defaults, {\n                graphConfig: {\n                    data: {\n                        json: data\n                    },\n                    axis: {\n                        x : {\n                            tick : {\n                                format: interval === 'P1D' ? '%H:%M' : '%m-%d'\n                            },\n                            label : {\n                                text:  interval === 'P1D' ? __('Hours') : __('Days')\n                            }\n                        }\n                    }\n                }\n            });\n            return newConfig;\n        }\n\n        $('.js-tasks-statistics-interval').on('change', function () {\n            activityGraph.refresh(getChartConfig());\n        });\n\n        return component(activityGraph)\n            .on('render', function() {\n                $('.modal .js-tasks-graph-container').show();\n                chart = c3.generate(getChartConfig().graphConfig);\n\n            })\n            .on('destroy', function() {\n                $('.js-tasks-graph-container').hide();\n                chart.destroy();\n                chart = null;\n            })\n            .init(initConfig);\n    }\n\n    return tasksGraphFactory;\n});\n\n","define('taoSystemStatus/controller/SystemStatus/index',[\n    'tpl!taoSystemStatus/controller/SystemStatus/reportDetailsModal',\n    'taoSystemStatus/tasksMonitoring/tasksStatistics'\n], function(layout, tasksStatisticsFactory) {\n    'use strict';\n\n    var $container;\n\n    function showTaskReport($modalContent) {\n        var $modal = $(layout({data: $modalContent.html()}));\n        $container.append($modal);\n        $modal.modal({\n            startClosed : true,\n            minWidth : 450\n        });\n        $modal.modal('open');\n\n        $modal.on('closed.modal', function() {\n            $modal.modal('destroy');\n            $(this).remove();\n        });\n    }\n\n    return {\n        start : function() {\n            var tasksStatistics;\n\n            $container = $('#system-status-report');\n            $container.on('click', '.js-feedback-details-button', function () {\n                var $modalContent = $(this).closest('.js-report').find('.js-feedback-details');\n                showTaskReport($modalContent);\n            });\n\n            tasksStatistics = tasksStatisticsFactory();\n            tasksStatistics.render();\n\n        }\n    }\n});\n\n","\ndefine(\"taoSystemStatus/loader/taoSystemStatus.bundle\", function(){});\n"]}